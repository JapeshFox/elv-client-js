

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      FrameClient.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      Eluvio Javascript Client
    </h3>

    

    <h3>Classes</h3><ul><li id="ElvClient-nav"><a href="ElvClient.html">ElvClient</a><ul class='methods'><li data-type="method" id="ElvClient-FromConfiguration-nav"><a href="ElvClient.html#.FromConfiguration">FromConfiguration</a></li><li data-type="method" id="ElvClient-CallContractMethod-nav"><a href="ElvClient.html#CallContractMethod">CallContractMethod</a></li><li data-type="method" id="ElvClient-CallContractMethodAndWait-nav"><a href="ElvClient.html#CallContractMethodAndWait">CallContractMethodAndWait</a></li><li data-type="method" id="ElvClient-ContentLibraries-nav"><a href="ElvClient.html#ContentLibraries">ContentLibraries</a></li><li data-type="method" id="ElvClient-ContentLibrary-nav"><a href="ElvClient.html#ContentLibrary">ContentLibrary</a></li><li data-type="method" id="ElvClient-ContentObject-nav"><a href="ElvClient.html#ContentObject">ContentObject</a></li><li data-type="method" id="ElvClient-ContentObjectMetadata-nav"><a href="ElvClient.html#ContentObjectMetadata">ContentObjectMetadata</a></li><li data-type="method" id="ElvClient-ContentObjects-nav"><a href="ElvClient.html#ContentObjects">ContentObjects</a></li><li data-type="method" id="ElvClient-ContentObjectVersions-nav"><a href="ElvClient.html#ContentObjectVersions">ContentObjectVersions</a></li><li data-type="method" id="ElvClient-ContentParts-nav"><a href="ElvClient.html#ContentParts">ContentParts</a></li><li data-type="method" id="ElvClient-ContentType-nav"><a href="ElvClient.html#ContentType">ContentType</a></li><li data-type="method" id="ElvClient-ContentTypes-nav"><a href="ElvClient.html#ContentTypes">ContentTypes</a></li><li data-type="method" id="ElvClient-CreateContentLibrary-nav"><a href="ElvClient.html#CreateContentLibrary">CreateContentLibrary</a></li><li data-type="method" id="ElvClient-CreateContentObject-nav"><a href="ElvClient.html#CreateContentObject">CreateContentObject</a></li><li data-type="method" id="ElvClient-CreateContentSpace-nav"><a href="ElvClient.html#CreateContentSpace">CreateContentSpace</a></li><li data-type="method" id="ElvClient-CreateContentType-nav"><a href="ElvClient.html#CreateContentType">CreateContentType</a></li><li data-type="method" id="ElvClient-DeleteContentLibrary-nav"><a href="ElvClient.html#DeleteContentLibrary">DeleteContentLibrary</a></li><li data-type="method" id="ElvClient-DeleteContentObject-nav"><a href="ElvClient.html#DeleteContentObject">DeleteContentObject</a></li><li data-type="method" id="ElvClient-DeleteContentVersion-nav"><a href="ElvClient.html#DeleteContentVersion">DeleteContentVersion</a></li><li data-type="method" id="ElvClient-DeleteMetadata-nav"><a href="ElvClient.html#DeleteMetadata">DeleteMetadata</a></li><li data-type="method" id="ElvClient-DeletePart-nav"><a href="ElvClient.html#DeletePart">DeletePart</a></li><li data-type="method" id="ElvClient-DeployContract-nav"><a href="ElvClient.html#DeployContract">DeployContract</a></li><li data-type="method" id="ElvClient-DownloadAllParts-nav"><a href="ElvClient.html#DownloadAllParts">DownloadAllParts</a></li><li data-type="method" id="ElvClient-DownloadPart-nav"><a href="ElvClient.html#DownloadPart">DownloadPart</a></li><li data-type="method" id="ElvClient-EditContentObject-nav"><a href="ElvClient.html#EditContentObject">EditContentObject</a></li><li data-type="method" id="ElvClient-ExtractValueFromEvent-nav"><a href="ElvClient.html#ExtractValueFromEvent">ExtractValueFromEvent</a></li><li data-type="method" id="ElvClient-FabricUrl-nav"><a href="ElvClient.html#FabricUrl">FabricUrl</a></li><li data-type="method" id="ElvClient-FinalizeContentObject-nav"><a href="ElvClient.html#FinalizeContentObject">FinalizeContentObject</a></li><li data-type="method" id="ElvClient-FormatContractArguments-nav"><a href="ElvClient.html#FormatContractArguments">FormatContractArguments</a></li><li data-type="method" id="ElvClient-GenerateWallet-nav"><a href="ElvClient.html#GenerateWallet">GenerateWallet</a></li><li data-type="method" id="ElvClient-MergeMetadata-nav"><a href="ElvClient.html#MergeMetadata">MergeMetadata</a></li><li data-type="method" id="ElvClient-Proofs-nav"><a href="ElvClient.html#Proofs">Proofs</a></li><li data-type="method" id="ElvClient-PublicLibraryMetadata-nav"><a href="ElvClient.html#PublicLibraryMetadata">PublicLibraryMetadata</a></li><li data-type="method" id="ElvClient-QParts-nav"><a href="ElvClient.html#QParts">QParts</a></li><li data-type="method" id="ElvClient-Rep-nav"><a href="ElvClient.html#Rep">Rep</a></li><li data-type="method" id="ElvClient-ReplaceMetadata-nav"><a href="ElvClient.html#ReplaceMetadata">ReplaceMetadata</a></li><li data-type="method" id="ElvClient-ReplacePublicLibraryMetadata-nav"><a href="ElvClient.html#ReplacePublicLibraryMetadata">ReplacePublicLibraryMetadata</a></li><li data-type="method" id="ElvClient-SetCustomContentContract-nav"><a href="ElvClient.html#SetCustomContentContract">SetCustomContentContract</a></li><li data-type="method" id="ElvClient-SetSigner-nav"><a href="ElvClient.html#SetSigner">SetSigner</a></li><li data-type="method" id="ElvClient-UploadPart-nav"><a href="ElvClient.html#UploadPart">UploadPart</a></li><li data-type="method" id="ElvClient-VerifyContentObject-nav"><a href="ElvClient.html#VerifyContentObject">VerifyContentObject</a></li></ul></li><li id="ElvWallet-nav"><a href="ElvWallet.html">ElvWallet</a><ul class='methods'><li data-type="method" id="ElvWallet-AddAccount-nav"><a href="ElvWallet.html#AddAccount">AddAccount</a></li><li data-type="method" id="ElvWallet-AddAccountFromEncryptedPK-nav"><a href="ElvWallet.html#AddAccountFromEncryptedPK">AddAccountFromEncryptedPK</a></li><li data-type="method" id="ElvWallet-AddAccountFromMnemonic-nav"><a href="ElvWallet.html#AddAccountFromMnemonic">AddAccountFromMnemonic</a></li><li data-type="method" id="ElvWallet-GenerateMnemonic-nav"><a href="ElvWallet.html#GenerateMnemonic">GenerateMnemonic</a></li><li data-type="method" id="ElvWallet-GetAccount-nav"><a href="ElvWallet.html#GetAccount">GetAccount</a></li><li data-type="method" id="ElvWallet-GetAccountBalance-nav"><a href="ElvWallet.html#GetAccountBalance">GetAccountBalance</a></li><li data-type="method" id="ElvWallet-GetEncryptedPrivateKey-nav"><a href="ElvWallet.html#GetEncryptedPrivateKey">GetEncryptedPrivateKey</a></li><li data-type="method" id="ElvWallet-RemoveAccount-nav"><a href="ElvWallet.html#RemoveAccount">RemoveAccount</a></li></ul></li><li id="FrameClient-nav"><a href="FrameClient.html">FrameClient</a><ul class='methods'><li data-type="method" id="FrameClient-AllowedMethods-nav"><a href="FrameClient.html#AllowedMethods">AllowedMethods</a></li></ul></li></ul><h3>Namespaces</h3><ul><li id="Utils-nav"><a href="Utils.html">Utils</a><ul class='methods'><li data-type="method" id="Utils-AddressToHash-nav"><a href="Utils.html#.AddressToHash">AddressToHash</a></li><li data-type="method" id="Utils-AddressToLibraryId-nav"><a href="Utils.html#.AddressToLibraryId">AddressToLibraryId</a></li><li data-type="method" id="Utils-AddressToObjectId-nav"><a href="Utils.html#.AddressToObjectId">AddressToObjectId</a></li><li data-type="method" id="Utils-AddressToSpaceId-nav"><a href="Utils.html#.AddressToSpaceId">AddressToSpaceId</a></li><li data-type="method" id="Utils-EqualHash-nav"><a href="Utils.html#.EqualHash">EqualHash</a></li><li data-type="method" id="Utils-HashToAddress-nav"><a href="Utils.html#.HashToAddress">HashToAddress</a></li><li data-type="method" id="Utils-IsCloneable-nav"><a href="Utils.html#.IsCloneable">IsCloneable</a></li><li data-type="method" id="Utils-MakeClonable-nav"><a href="Utils.html#.MakeClonable">MakeClonable</a></li><li data-type="method" id="Utils-ToBytes32-nav"><a href="Utils.html#.ToBytes32">ToBytes32</a></li></ul></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        FrameClient.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>const Id = require("./Id");
const Utils = require("./Utils");

class FrameClient {
  /**
   * FrameClient is a client that looks to the user like an ElvClient, but works by passing messages
   * to another frame with an actual ElvClient instead of making the calls itself.
   *
   * The purpose of this is to isolate users' private keys and the usage thereof in one trusted application,
   * while still allowing other (possibly less trustworthy) applications to communicate with the content fabric
   * on behalf of the user from a sandboxed IFrame.
   *
   * FrameClient has available almost all of the same methods as ElvClient, and should be transparently
   * interchangable with it from a usage perspective.
   *
   * The methods available in FrameClient are generated automatically from ElvClient. These methods will use a
   * messaging protocol to communicate intent to a specified frame, which can listen for such messages, perform
   * the actions using the real ElvClient, and return the results via a response message.
   *
   * Because the privileged frame is doing the actual work, it may decide to allow or disallow any actions
   * it sees fit - for example, limiting a dependent app to a few safe calls while preventing it from making any
   * significant changes.
   *
   * The most important aspect of this architecture is to prevent leaking of users' private keys. Be careful when
   * setting up a project using this architecture - make sure the untrusted app is properly contained in a sandboxed
   * IFrame and served from a different origin than the privileged app.
   *
   * @see test/frames/Parent.html and test/frames/Client.html for an example setup using this scheme
   *
   * @namedParams
   * @param {Object} target - The window or frame that will listen for messages produced by this client
   * @param {number} timeout - How long to wait for a response after calling a method before giving up
   * and generating a timeout error
   */
  constructor({target=parent, timeout=5}) {
    this.timeout = timeout;

    this.utils = Utils;

    // Dynamically defined methods defined in AllowedMethods
    for(const methodName of this.AllowedMethods()){
      this[methodName] = async (args) => {
        const requestId = Id.next();

        target.postMessage({
          type: "ElvFrameRequest",
          requestId,
          calledMethod: methodName,
          args: this.utils.MakeClonable(args)
        }, "*");

        return await this.AwaitMessage(requestId, 5000);
      };
    }
  }

  AwaitMessage(requestId) {
    return new Promise((resolve, reject) => {
      const listener = async (event) => {
        try {
          const message = event.data;

          if (message.type !== "ElvFrameResponse" || message.requestId !== requestId) {
            return;
          }

          if (message.error) {
            reject(message.error);
          } else {
            resolve(message.response);
          }

          window.removeEventListener("message", listener);
        } catch(error){
          reject(error);

          window.removeEventListener("message", listener);
        }
      };

      if(this.timeout > 0) {
        // If promise has not been resolved after specified timeout,
        // remove listener and send error response
        setTimeout(() => {
          reject("Request timed out " + requestId);

          window.removeEventListener("message", listener);
        }, this.timeout * 1000);
      }

      window.addEventListener("message", listener);
    });
  }

  // List of allowed methods available to frames
  // This should match ElvClient.FrameAvailableMethods()
  // ElvClient will also reject any disallowed methods
  /**
   * @returns {Array&lt;string>} - List of ElvClient methods available to a FrameClient
   */
  AllowedMethods() {
    return [
      "CallContractMethod",
      "CallContractMethodAndWait",
      "ContentLibraries",
      "ContentLibrary",
      "ContentObject",
      "ContentObjectMetadata",
      "ContentObjectVersions",
      "ContentObjects",
      "ContentParts",
      "ContentType",
      "ContentTypes",
      "CreateContentLibrary",
      "CreateContentObject",
      "CreateContentSpace",
      "CreateContentType",
      "CreateFileUploadJob",
      "DeleteContentLibrary",
      "DeleteContentObject",
      "DeleteContentVersion",
      "DeleteMetadata",
      "DeleteName",
      "DeletePart",
      "DeployContract",
      "DownloadAllParts",
      "DownloadFile",
      "DownloadPart",
      "EditContentObject",
      "ExtractValueFromEvent",
      "FabricUrl",
      "FinalizeContentObject",
      "FinalizeUploadJobs",
      "FormatContractArguments",
      "GetByName",
      "GetObjectByName",
      "MergeMetadata",
      "Proofs",
      "PublicLibraryMetadata",
      "QParts",
      "Rep",
      "ReplaceMetadata",
      "ReplacePublicLibraryMetadata",
      "SetByName",
      "SetCustomContentContract",
      "SetObjectByName",
      "UploadFileData",
      "UploadJobStatus",
      "UploadPart",
      "VerifyContentObject"
    ];
  }
}

exports.FrameClient = FrameClient;
</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
  </footer>

<script>prettyPrint();</script>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
